<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speed Typing</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="main-box">
        <div class="word-box-container">
            <div class="word-box" id="1"></div>
            <div class="word-box" id="2"></div>
            <div class="word-box" id="3"></div>
            <div class="word-box" id="4"></div>
            <div class="word-box" id="5"></div>
        </div>
        <input id="inputArea" type="text" oninput="checkWord()" style="margin:10px">
        <span id="timeLeft"></span>
        <span id="score">Score : 0</span>
    </div>
</body>

<script>
let wordNumber=document.querySelectorAll(".word-box").length;
let wordToDivDictionary=new Map();
let timeLeft=100;
let timerInterval;
let score=0;

async function getWords(){
    let words=[];
    let res = await fetch(`https://random-word-api.herokuapp.com/word?number=${wordNumber}&swear=0`)
    .then(res=>res.json()
    .then(w=>words.push(w))
    );
    words=words.flat();
    return words;
}

async function setWords(){
    let words = await getWords();
    let boxes=document.querySelectorAll(".word-box");
    for(let i=0;i<words.length;i++){
        wordToDivDictionary.set(words[i],boxes[i]);
        boxes[i].innerText=words[i];
        console.log(wordToDivDictionary)
    }
}

async function getWord(){
    let word;
    let res = await fetch(`https://random-word-api.herokuapp.com/word?number=1&swear=0`)
    .then(res=>res.json()
    .then(w=>word=w[0])
    );
    return word;
}

function checkWord(){
    let word=document.querySelector("#inputArea").value;
    let div=wordToDivDictionary.get(word);
    if(div){
        document.querySelector("#inputArea").value="";
        score++;
        document.querySelector("#score").innerText=`Score : ${score}`
        wordToDivDictionary.delete(word);
        editDiv(div)
    }

}

async function editDiv(div){
    let word=await getWord();
    div.innerText=word;
    wordToDivDictionary.set(word,div)
}

function decreaseTimer(){
    if(timeLeft===1){
        document.querySelector("#inputArea").disabled=true;
        clearInterval(timerInterval);
    }
    timeLeft--;
    document.querySelector("#timeLeft").innerText=timeLeft;
}

async function init(){
    await setWords();
    document.querySelector("#timeLeft").innerText=timeLeft;
    timerInterval=setInterval(decreaseTimer,1000);
    document.getElementById("inputArea").focus();
}


init();
</script>

</html>